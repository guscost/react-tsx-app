define(["require", "exports", "react/jsx-runtime", "react", "recharts", "@/lib/utils"], function (require, exports, jsx_runtime_1, React, RechartsPrimitive, utils_1) {
    "use client";
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    exports.ChartStyle = exports.ChartLegendContent = exports.ChartLegend = exports.ChartTooltipContent = exports.ChartTooltip = exports.ChartContainer = void 0;
    // Format: { THEME_NAME: CSS_SELECTOR }
    const THEMES = { light: "", dark: ".dark" };
    const ChartContext = React.createContext(null);
    function useChart() {
        const context = React.useContext(ChartContext);
        if (!context) {
            throw new Error("useChart must be used within a <ChartContainer />");
        }
        return context;
    }
    const ChartContainer = React.forwardRef(({ id, className, children, config, ...props }, ref) => {
        const uniqueId = React.useId();
        const chartId = `chart-${id || uniqueId.replace(/:/g, "")}`;
        return ((0, jsx_runtime_1.jsx)(ChartContext.Provider, { value: { config }, children: (0, jsx_runtime_1.jsxs)("div", { "data-slot": "chart", "data-chart": chartId, ref: ref, className: (0, utils_1.cn)("[&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border flex aspect-video justify-center text-xs [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-hidden [&_.recharts-sector]:outline-hidden [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-surface]:outline-hidden", className), ...props, children: [(0, jsx_runtime_1.jsx)(ChartStyle, { id: chartId, config: config }), (0, jsx_runtime_1.jsx)(RechartsPrimitive.ResponsiveContainer, { children: children })] }) }));
    });
    exports.ChartContainer = ChartContainer;
    ChartContainer.displayName = "Chart";
    const ChartStyle = ({ id, config }) => {
        const colorConfig = Object.entries(config).filter(([, config]) => config.theme || config.color);
        if (!colorConfig.length) {
            return null;
        }
        return ((0, jsx_runtime_1.jsx)("style", { dangerouslySetInnerHTML: {
                __html: Object.entries(THEMES)
                    .map(([theme, prefix]) => `
${prefix} [data-chart=${id}] {
${colorConfig
                    .map(([key, itemConfig]) => {
                    var _a;
                    const color = ((_a = itemConfig.theme) === null || _a === void 0 ? void 0 : _a[theme]) ||
                        itemConfig.color;
                    return color ? `  --color-${key}: ${color};` : null;
                })
                    .join("\n")}
}
`)
                    .join("\n"),
            } }));
    };
    exports.ChartStyle = ChartStyle;
    const ChartTooltip = RechartsPrimitive.Tooltip;
    exports.ChartTooltip = ChartTooltip;
    const ChartTooltipContent = React.forwardRef(({ active, payload, className, indicator = "dot", hideLabel = false, hideIndicator = false, label, labelFormatter, labelClassName, formatter, color, nameKey, labelKey, }, ref) => {
        const { config } = useChart();
        const tooltipLabel = React.useMemo(() => {
            var _a;
            if (hideLabel || !(payload === null || payload === void 0 ? void 0 : payload.length)) {
                return null;
            }
            const [item] = payload;
            const key = `${labelKey || item.dataKey || item.name || "value"}`;
            const itemConfig = getPayloadConfigFromPayload(config, item, key);
            const value = !labelKey && typeof label === "string"
                ? ((_a = config[label]) === null || _a === void 0 ? void 0 : _a.label) || label
                : itemConfig === null || itemConfig === void 0 ? void 0 : itemConfig.label;
            if (labelFormatter) {
                return ((0, jsx_runtime_1.jsx)("div", { className: (0, utils_1.cn)("font-medium", labelClassName), children: labelFormatter(value, payload) }));
            }
            if (!value) {
                return null;
            }
            return (0, jsx_runtime_1.jsx)("div", { className: (0, utils_1.cn)("font-medium", labelClassName), children: value });
        }, [
            label,
            labelFormatter,
            payload,
            hideLabel,
            labelClassName,
            config,
            labelKey,
        ]);
        if (!active || !(payload === null || payload === void 0 ? void 0 : payload.length)) {
            return null;
        }
        const nestLabel = payload.length === 1 && indicator !== "dot";
        return ((0, jsx_runtime_1.jsxs)("div", { ref: ref, className: (0, utils_1.cn)("border-border/50 bg-background grid min-w-[8rem] items-start gap-1.5 rounded-lg border px-2.5 py-1.5 text-xs shadow-xl", className), children: [!nestLabel ? tooltipLabel : null, (0, jsx_runtime_1.jsx)("div", { className: "grid gap-1.5", children: payload.map((item, index) => {
                        const key = `${nameKey || item.name || item.dataKey || "value"}`;
                        const itemConfig = getPayloadConfigFromPayload(config, item, key);
                        const indicatorColor = color || item.payload.fill || item.color;
                        return ((0, jsx_runtime_1.jsx)("div", { className: (0, utils_1.cn)("[&>svg]:text-muted-foreground flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5", indicator === "dot" && "items-center"), children: formatter && (item === null || item === void 0 ? void 0 : item.value) !== undefined && item.name ? (formatter(item.value, item.name, item, index, item.payload)) : ((0, jsx_runtime_1.jsxs)(jsx_runtime_1.Fragment, { children: [(itemConfig === null || itemConfig === void 0 ? void 0 : itemConfig.icon) ? ((0, jsx_runtime_1.jsx)(itemConfig.icon, {})) : (!hideIndicator && ((0, jsx_runtime_1.jsx)("div", { className: (0, utils_1.cn)("shrink-0 rounded-[2px] border-(--color-border) bg-(--color-bg)", {
                                            "h-2.5 w-2.5": indicator === "dot",
                                            "w-1": indicator === "line",
                                            "w-0 border-[1.5px] border-dashed bg-transparent": indicator === "dashed",
                                            "my-0.5": nestLabel && indicator === "dashed",
                                        }), style: {
                                            "--color-bg": indicatorColor,
                                            "--color-border": indicatorColor,
                                        } }))), (0, jsx_runtime_1.jsxs)("div", { className: (0, utils_1.cn)("flex flex-1 justify-between leading-none", nestLabel ? "items-end" : "items-center"), children: [(0, jsx_runtime_1.jsxs)("div", { className: "grid gap-1.5", children: [nestLabel ? tooltipLabel : null, (0, jsx_runtime_1.jsx)("span", { className: "text-muted-foreground", children: (itemConfig === null || itemConfig === void 0 ? void 0 : itemConfig.label) || item.name })] }), item.value && ((0, jsx_runtime_1.jsx)("span", { className: "text-foreground font-mono font-medium tabular-nums", children: item.value.toLocaleString() }))] })] })) }, item.dataKey));
                    }) })] }));
    });
    exports.ChartTooltipContent = ChartTooltipContent;
    ChartTooltipContent.displayName = "ChartTooltip";
    const ChartLegend = RechartsPrimitive.Legend;
    exports.ChartLegend = ChartLegend;
    const ChartLegendContent = React.forwardRef(({ className, hideIcon = false, payload, verticalAlign = "bottom", nameKey }, ref) => {
        const { config } = useChart();
        if (!(payload === null || payload === void 0 ? void 0 : payload.length)) {
            return null;
        }
        return ((0, jsx_runtime_1.jsx)("div", { ref: ref, className: (0, utils_1.cn)("flex items-center justify-center gap-4", verticalAlign === "top" ? "pb-3" : "pt-3", className), children: payload.map((item) => {
                const key = `${nameKey || item.dataKey || "value"}`;
                const itemConfig = getPayloadConfigFromPayload(config, item, key);
                return ((0, jsx_runtime_1.jsxs)("div", { className: (0, utils_1.cn)("[&>svg]:text-muted-foreground flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3"), children: [(itemConfig === null || itemConfig === void 0 ? void 0 : itemConfig.icon) && !hideIcon ? ((0, jsx_runtime_1.jsx)(itemConfig.icon, {})) : ((0, jsx_runtime_1.jsx)("div", { className: "h-2 w-2 shrink-0 rounded-[2px]", style: {
                                backgroundColor: item.color,
                            } })), itemConfig === null || itemConfig === void 0 ? void 0 : itemConfig.label] }, item.value));
            }) }));
    });
    exports.ChartLegendContent = ChartLegendContent;
    ChartLegendContent.displayName = "ChartLegend";
    // Helper to extract item config from a payload.
    function getPayloadConfigFromPayload(config, payload, key) {
        if (typeof payload !== "object" || payload === null) {
            return undefined;
        }
        const payloadPayload = "payload" in payload &&
            typeof payload.payload === "object" &&
            payload.payload !== null
            ? payload.payload
            : undefined;
        let configLabelKey = key;
        if (key in payload &&
            typeof payload[key] === "string") {
            configLabelKey = payload[key];
        }
        else if (payloadPayload &&
            key in payloadPayload &&
            typeof payloadPayload[key] === "string") {
            configLabelKey = payloadPayload[key];
        }
        return configLabelKey in config
            ? config[configLabelKey]
            : config[key];
    }
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiY2hhcnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvY29tcG9uZW50cy91aS9jaGFydC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtJQUFBLFlBQVksQ0FBQzs7OztJQU9iLHVDQUF1QztJQUN2QyxNQUFNLE1BQU0sR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsSUFBSSxFQUFFLE9BQU8sRUFBVyxDQUFDO0lBZ0JyRCxNQUFNLFlBQVksR0FBRyxLQUFLLENBQUMsYUFBYSxDQUEyQixJQUFJLENBQUMsQ0FBQztJQUV6RSxTQUFTLFFBQVE7UUFDZixNQUFNLE9BQU8sR0FBRyxLQUFLLENBQUMsVUFBVSxDQUFDLFlBQVksQ0FBQyxDQUFDO1FBRS9DLElBQUksQ0FBQyxPQUFPLEVBQUUsQ0FBQztZQUNiLE1BQU0sSUFBSSxLQUFLLENBQUMsbURBQW1ELENBQUMsQ0FBQztRQUN2RSxDQUFDO1FBRUQsT0FBTyxPQUFPLENBQUM7SUFDakIsQ0FBQztJQUVELE1BQU0sY0FBYyxHQUFHLEtBQUssQ0FBQyxVQUFVLENBUXJDLENBQUMsRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsR0FBRyxLQUFLLEVBQUUsRUFBRSxHQUFHLEVBQUUsRUFBRTtRQUN2RCxNQUFNLFFBQVEsR0FBRyxLQUFLLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDL0IsTUFBTSxPQUFPLEdBQUcsU0FBUyxFQUFFLElBQUksUUFBUSxDQUFDLE9BQU8sQ0FBQyxJQUFJLEVBQUUsRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUU1RCxPQUFPLENBQ0wsdUJBQUMsWUFBWSxDQUFDLFFBQVEsSUFBQyxLQUFLLEVBQUUsRUFBRSxNQUFNLEVBQUUsWUFDdEMsOENBQ1ksT0FBTyxnQkFDTCxPQUFPLEVBQ25CLEdBQUcsRUFBRSxHQUFHLEVBQ1IsU0FBUyxFQUFFLElBQUEsVUFBRSxFQUNYLDZwQkFBNnBCLEVBQzdwQixTQUFTLENBQ1YsS0FDRyxLQUFLLGFBRVQsdUJBQUMsVUFBVSxJQUFDLEVBQUUsRUFBRSxPQUFPLEVBQUUsTUFBTSxFQUFFLE1BQU0sR0FBSSxFQUMzQyx1QkFBQyxpQkFBaUIsQ0FBQyxtQkFBbUIsY0FDbkMsUUFBUSxHQUM2QixJQUNwQyxHQUNnQixDQUN6QixDQUFDO0lBQ0osQ0FBQyxDQUFDLENBQUM7SUFvU0Qsd0NBQWM7SUFuU2hCLGNBQWMsQ0FBQyxXQUFXLEdBQUcsT0FBTyxDQUFDO0lBRXJDLE1BQU0sVUFBVSxHQUFHLENBQUMsRUFBRSxFQUFFLEVBQUUsTUFBTSxFQUF1QyxFQUFFLEVBQUU7UUFDekUsTUFBTSxXQUFXLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsQ0FBQyxNQUFNLENBQy9DLENBQUMsQ0FBQyxFQUFFLE1BQU0sQ0FBQyxFQUFFLEVBQUUsQ0FBQyxNQUFNLENBQUMsS0FBSyxJQUFJLE1BQU0sQ0FBQyxLQUFLLENBQzdDLENBQUM7UUFFRixJQUFJLENBQUMsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDO1lBQ3hCLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELE9BQU8sQ0FDTCxrQ0FDRSx1QkFBdUIsRUFBRTtnQkFDdkIsTUFBTSxFQUFFLE1BQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDO3FCQUMzQixHQUFHLENBQ0YsQ0FBQyxDQUFDLEtBQUssRUFBRSxNQUFNLENBQUMsRUFBRSxFQUFFLENBQUM7RUFDL0IsTUFBTSxnQkFBZ0IsRUFBRTtFQUN4QixXQUFXO3FCQUNWLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxFQUFFLFVBQVUsQ0FBQyxFQUFFLEVBQUU7O29CQUN6QixNQUFNLEtBQUssR0FDVCxDQUFBLE1BQUEsVUFBVSxDQUFDLEtBQUssMENBQUcsS0FBc0MsQ0FBQzt3QkFDMUQsVUFBVSxDQUFDLEtBQUssQ0FBQztvQkFDbkIsT0FBTyxLQUFLLENBQUMsQ0FBQyxDQUFDLGFBQWEsR0FBRyxLQUFLLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUM7Z0JBQ3RELENBQUMsQ0FBQztxQkFDRCxJQUFJLENBQUMsSUFBSSxDQUFDOztDQUVaLENBQ1U7cUJBQ0EsSUFBSSxDQUFDLElBQUksQ0FBQzthQUNkLEdBQ0QsQ0FDSCxDQUFDO0lBQ0osQ0FBQyxDQUFDO0lBdVFBLGdDQUFVO0lBclFaLE1BQU0sWUFBWSxHQUFHLGlCQUFpQixDQUFDLE9BQU8sQ0FBQztJQWlRN0Msb0NBQVk7SUEvUGQsTUFBTSxtQkFBbUIsR0FBRyxLQUFLLENBQUMsVUFBVSxDQVcxQyxDQUNFLEVBQ0UsTUFBTSxFQUNOLE9BQU8sRUFDUCxTQUFTLEVBQ1QsU0FBUyxHQUFHLEtBQUssRUFDakIsU0FBUyxHQUFHLEtBQUssRUFDakIsYUFBYSxHQUFHLEtBQUssRUFDckIsS0FBSyxFQUNMLGNBQWMsRUFDZCxjQUFjLEVBQ2QsU0FBUyxFQUNULEtBQUssRUFDTCxPQUFPLEVBQ1AsUUFBUSxHQUNULEVBQ0QsR0FBRyxFQUNILEVBQUU7UUFDRixNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsUUFBUSxFQUFFLENBQUM7UUFFOUIsTUFBTSxZQUFZLEdBQUcsS0FBSyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEVBQUU7O1lBQ3RDLElBQUksU0FBUyxJQUFJLENBQUMsQ0FBQSxPQUFPLGFBQVAsT0FBTyx1QkFBUCxPQUFPLENBQUUsTUFBTSxDQUFBLEVBQUUsQ0FBQztnQkFDbEMsT0FBTyxJQUFJLENBQUM7WUFDZCxDQUFDO1lBRUQsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLE9BQU8sQ0FBQztZQUN2QixNQUFNLEdBQUcsR0FBRyxHQUFHLFFBQVEsSUFBSSxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksT0FBTyxFQUFFLENBQUM7WUFDbEUsTUFBTSxVQUFVLEdBQUcsMkJBQTJCLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQztZQUNsRSxNQUFNLEtBQUssR0FDVCxDQUFDLFFBQVEsSUFBSSxPQUFPLEtBQUssS0FBSyxRQUFRO2dCQUNwQyxDQUFDLENBQUMsQ0FBQSxNQUFBLE1BQU0sQ0FBQyxLQUE0QixDQUFDLDBDQUFFLEtBQUssS0FBSSxLQUFLO2dCQUN0RCxDQUFDLENBQUMsVUFBVSxhQUFWLFVBQVUsdUJBQVYsVUFBVSxDQUFFLEtBQUssQ0FBQztZQUV4QixJQUFJLGNBQWMsRUFBRSxDQUFDO2dCQUNuQixPQUFPLENBQ0wsZ0NBQUssU0FBUyxFQUFFLElBQUEsVUFBRSxFQUFDLGFBQWEsRUFBRSxjQUFjLENBQUMsWUFDOUMsY0FBYyxDQUFDLEtBQUssRUFBRSxPQUFPLENBQUMsR0FDM0IsQ0FDUCxDQUFDO1lBQ0osQ0FBQztZQUVELElBQUksQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDWCxPQUFPLElBQUksQ0FBQztZQUNkLENBQUM7WUFFRCxPQUFPLGdDQUFLLFNBQVMsRUFBRSxJQUFBLFVBQUUsRUFBQyxhQUFhLEVBQUUsY0FBYyxDQUFDLFlBQUcsS0FBSyxHQUFPLENBQUM7UUFDMUUsQ0FBQyxFQUFFO1lBQ0QsS0FBSztZQUNMLGNBQWM7WUFDZCxPQUFPO1lBQ1AsU0FBUztZQUNULGNBQWM7WUFDZCxNQUFNO1lBQ04sUUFBUTtTQUNULENBQUMsQ0FBQztRQUVILElBQUksQ0FBQyxNQUFNLElBQUksQ0FBQyxDQUFBLE9BQU8sYUFBUCxPQUFPLHVCQUFQLE9BQU8sQ0FBRSxNQUFNLENBQUEsRUFBRSxDQUFDO1lBQ2hDLE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQztRQUVELE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQyxNQUFNLEtBQUssQ0FBQyxJQUFJLFNBQVMsS0FBSyxLQUFLLENBQUM7UUFFOUQsT0FBTyxDQUNMLGlDQUNFLEdBQUcsRUFBRSxHQUFHLEVBQ1IsU0FBUyxFQUFFLElBQUEsVUFBRSxFQUNYLHdIQUF3SCxFQUN4SCxTQUFTLENBQ1YsYUFFQSxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxJQUFJLEVBQ2pDLGdDQUFLLFNBQVMsRUFBQyxjQUFjLFlBQzFCLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxJQUFJLEVBQUUsS0FBSyxFQUFFLEVBQUU7d0JBQzNCLE1BQU0sR0FBRyxHQUFHLEdBQUcsT0FBTyxJQUFJLElBQUksQ0FBQyxJQUFJLElBQUksSUFBSSxDQUFDLE9BQU8sSUFBSSxPQUFPLEVBQUUsQ0FBQzt3QkFDakUsTUFBTSxVQUFVLEdBQUcsMkJBQTJCLENBQUMsTUFBTSxFQUFFLElBQUksRUFBRSxHQUFHLENBQUMsQ0FBQzt3QkFDbEUsTUFBTSxjQUFjLEdBQUcsS0FBSyxJQUFJLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxJQUFJLElBQUksQ0FBQyxLQUFLLENBQUM7d0JBRWhFLE9BQU8sQ0FDTCxnQ0FFRSxTQUFTLEVBQUUsSUFBQSxVQUFFLEVBQ1gscUdBQXFHLEVBQ3JHLFNBQVMsS0FBSyxLQUFLLElBQUksY0FBYyxDQUN0QyxZQUVBLFNBQVMsSUFBSSxDQUFBLElBQUksYUFBSixJQUFJLHVCQUFKLElBQUksQ0FBRSxLQUFLLE1BQUssU0FBUyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLENBQ3JELFNBQVMsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxFQUFFLEtBQUssRUFBRSxJQUFJLENBQUMsT0FBTyxDQUFDLENBQzVELENBQUMsQ0FBQyxDQUFDLENBQ0YsNkRBQ0csQ0FBQSxVQUFVLGFBQVYsVUFBVSx1QkFBVixVQUFVLENBQUUsSUFBSSxFQUFDLENBQUMsQ0FBQyxDQUNsQix1QkFBQyxVQUFVLENBQUMsSUFBSSxLQUFHLENBQ3BCLENBQUMsQ0FBQyxDQUFDLENBQ0YsQ0FBQyxhQUFhLElBQUksQ0FDaEIsZ0NBQ0UsU0FBUyxFQUFFLElBQUEsVUFBRSxFQUNYLGdFQUFnRSxFQUNoRTs0Q0FDRSxhQUFhLEVBQUUsU0FBUyxLQUFLLEtBQUs7NENBQ2xDLEtBQUssRUFBRSxTQUFTLEtBQUssTUFBTTs0Q0FDM0IsaURBQWlELEVBQy9DLFNBQVMsS0FBSyxRQUFROzRDQUN4QixRQUFRLEVBQUUsU0FBUyxJQUFJLFNBQVMsS0FBSyxRQUFRO3lDQUM5QyxDQUNGLEVBQ0QsS0FBSyxFQUNIOzRDQUNFLFlBQVksRUFBRSxjQUFjOzRDQUM1QixnQkFBZ0IsRUFBRSxjQUFjO3lDQUNWLEdBRTFCLENBQ0gsQ0FDRixFQUNELGlDQUNFLFNBQVMsRUFBRSxJQUFBLFVBQUUsRUFDWCwwQ0FBMEMsRUFDMUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLGNBQWMsQ0FDekMsYUFFRCxpQ0FBSyxTQUFTLEVBQUMsY0FBYyxhQUMxQixTQUFTLENBQUMsQ0FBQyxDQUFDLFlBQVksQ0FBQyxDQUFDLENBQUMsSUFBSSxFQUNoQyxpQ0FBTSxTQUFTLEVBQUMsdUJBQXVCLFlBQ3BDLENBQUEsVUFBVSxhQUFWLFVBQVUsdUJBQVYsVUFBVSxDQUFFLEtBQUssS0FBSSxJQUFJLENBQUMsSUFBSSxHQUMxQixJQUNILEVBQ0wsSUFBSSxDQUFDLEtBQUssSUFBSSxDQUNiLGlDQUFNLFNBQVMsRUFBQyxvREFBb0QsWUFDakUsSUFBSSxDQUFDLEtBQUssQ0FBQyxjQUFjLEVBQUUsR0FDdkIsQ0FDUixJQUNHLElBQ0wsQ0FDSixJQXJESSxJQUFJLENBQUMsT0FBTyxDQXNEYixDQUNQLENBQUM7b0JBQ0osQ0FBQyxDQUFDLEdBQ0UsSUFDRixDQUNQLENBQUM7SUFDSixDQUFDLENBQ0YsQ0FBQztJQXlHQSxrREFBbUI7SUF4R3JCLG1CQUFtQixDQUFDLFdBQVcsR0FBRyxjQUFjLENBQUM7SUFFakQsTUFBTSxXQUFXLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxDQUFDO0lBdUczQyxrQ0FBVztJQXJHYixNQUFNLGtCQUFrQixHQUFHLEtBQUssQ0FBQyxVQUFVLENBUXpDLENBQ0UsRUFBRSxTQUFTLEVBQUUsUUFBUSxHQUFHLEtBQUssRUFBRSxPQUFPLEVBQUUsYUFBYSxHQUFHLFFBQVEsRUFBRSxPQUFPLEVBQUUsRUFDM0UsR0FBRyxFQUNILEVBQUU7UUFDRixNQUFNLEVBQUUsTUFBTSxFQUFFLEdBQUcsUUFBUSxFQUFFLENBQUM7UUFFOUIsSUFBSSxDQUFDLENBQUEsT0FBTyxhQUFQLE9BQU8sdUJBQVAsT0FBTyxDQUFFLE1BQU0sQ0FBQSxFQUFFLENBQUM7WUFDckIsT0FBTyxJQUFJLENBQUM7UUFDZCxDQUFDO1FBRUQsT0FBTyxDQUNMLGdDQUNFLEdBQUcsRUFBRSxHQUFHLEVBQ1IsU0FBUyxFQUFFLElBQUEsVUFBRSxFQUNYLHdDQUF3QyxFQUN4QyxhQUFhLEtBQUssS0FBSyxDQUFDLENBQUMsQ0FBQyxNQUFNLENBQUMsQ0FBQyxDQUFDLE1BQU0sRUFDekMsU0FBUyxDQUNWLFlBRUEsT0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksRUFBRSxFQUFFO2dCQUNwQixNQUFNLEdBQUcsR0FBRyxHQUFHLE9BQU8sSUFBSSxJQUFJLENBQUMsT0FBTyxJQUFJLE9BQU8sRUFBRSxDQUFDO2dCQUNwRCxNQUFNLFVBQVUsR0FBRywyQkFBMkIsQ0FBQyxNQUFNLEVBQUUsSUFBSSxFQUFFLEdBQUcsQ0FBQyxDQUFDO2dCQUVsRSxPQUFPLENBQ0wsaUNBRUUsU0FBUyxFQUFFLElBQUEsVUFBRSxFQUNYLGlGQUFpRixDQUNsRixhQUVBLENBQUEsVUFBVSxhQUFWLFVBQVUsdUJBQVYsVUFBVSxDQUFFLElBQUksS0FBSSxDQUFDLFFBQVEsQ0FBQyxDQUFDLENBQUMsQ0FDL0IsdUJBQUMsVUFBVSxDQUFDLElBQUksS0FBRyxDQUNwQixDQUFDLENBQUMsQ0FBQyxDQUNGLGdDQUNFLFNBQVMsRUFBQyxnQ0FBZ0MsRUFDMUMsS0FBSyxFQUFFO2dDQUNMLGVBQWUsRUFBRSxJQUFJLENBQUMsS0FBSzs2QkFDNUIsR0FDRCxDQUNILEVBQ0EsVUFBVSxhQUFWLFVBQVUsdUJBQVYsVUFBVSxDQUFFLEtBQUssS0FmYixJQUFJLENBQUMsS0FBSyxDQWdCWCxDQUNQLENBQUM7WUFDSixDQUFDLENBQUMsR0FDRSxDQUNQLENBQUM7SUFDSixDQUFDLENBQ0YsQ0FBQztJQStDQSxnREFBa0I7SUE5Q3BCLGtCQUFrQixDQUFDLFdBQVcsR0FBRyxhQUFhLENBQUM7SUFFL0MsZ0RBQWdEO0lBQ2hELFNBQVMsMkJBQTJCLENBQ2xDLE1BQW1CLEVBQ25CLE9BQWdCLEVBQ2hCLEdBQVc7UUFFWCxJQUFJLE9BQU8sT0FBTyxLQUFLLFFBQVEsSUFBSSxPQUFPLEtBQUssSUFBSSxFQUFFLENBQUM7WUFDcEQsT0FBTyxTQUFTLENBQUM7UUFDbkIsQ0FBQztRQUVELE1BQU0sY0FBYyxHQUNsQixTQUFTLElBQUksT0FBTztZQUNwQixPQUFPLE9BQU8sQ0FBQyxPQUFPLEtBQUssUUFBUTtZQUNuQyxPQUFPLENBQUMsT0FBTyxLQUFLLElBQUk7WUFDdEIsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxPQUFPO1lBQ2pCLENBQUMsQ0FBQyxTQUFTLENBQUM7UUFFaEIsSUFBSSxjQUFjLEdBQVcsR0FBRyxDQUFDO1FBRWpDLElBQ0UsR0FBRyxJQUFJLE9BQU87WUFDZCxPQUFPLE9BQU8sQ0FBQyxHQUEyQixDQUFDLEtBQUssUUFBUSxFQUN4RCxDQUFDO1lBQ0QsY0FBYyxHQUFHLE9BQU8sQ0FBQyxHQUEyQixDQUFXLENBQUM7UUFDbEUsQ0FBQzthQUFNLElBQ0wsY0FBYztZQUNkLEdBQUcsSUFBSSxjQUFjO1lBQ3JCLE9BQU8sY0FBYyxDQUFDLEdBQWtDLENBQUMsS0FBSyxRQUFRLEVBQ3RFLENBQUM7WUFDRCxjQUFjLEdBQUcsY0FBYyxDQUM3QixHQUFrQyxDQUN6QixDQUFDO1FBQ2QsQ0FBQztRQUVELE9BQU8sY0FBYyxJQUFJLE1BQU07WUFDN0IsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxjQUFjLENBQUM7WUFDeEIsQ0FBQyxDQUFDLE1BQU0sQ0FBQyxHQUEwQixDQUFDLENBQUM7SUFDekMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIGNsaWVudFwiO1xuXG5pbXBvcnQgKiBhcyBSZWFjdCBmcm9tIFwicmVhY3RcIjtcbmltcG9ydCAqIGFzIFJlY2hhcnRzUHJpbWl0aXZlIGZyb20gXCJyZWNoYXJ0c1wiO1xuXG5pbXBvcnQgeyBjbiB9IGZyb20gXCJAL2xpYi91dGlsc1wiO1xuXG4vLyBGb3JtYXQ6IHsgVEhFTUVfTkFNRTogQ1NTX1NFTEVDVE9SIH1cbmNvbnN0IFRIRU1FUyA9IHsgbGlnaHQ6IFwiXCIsIGRhcms6IFwiLmRhcmtcIiB9IGFzIGNvbnN0O1xuXG5leHBvcnQgdHlwZSBDaGFydENvbmZpZyA9IHtcbiAgW2sgaW4gc3RyaW5nXToge1xuICAgIGxhYmVsPzogUmVhY3QuUmVhY3ROb2RlO1xuICAgIGljb24/OiBSZWFjdC5Db21wb25lbnRUeXBlO1xuICB9ICYgKFxuICAgIHwgeyBjb2xvcj86IHN0cmluZzsgdGhlbWU/OiBuZXZlciB9XG4gICAgfCB7IGNvbG9yPzogbmV2ZXI7IHRoZW1lOiBSZWNvcmQ8a2V5b2YgdHlwZW9mIFRIRU1FUywgc3RyaW5nPiB9XG4gICk7XG59O1xuXG50eXBlIENoYXJ0Q29udGV4dFByb3BzID0ge1xuICBjb25maWc6IENoYXJ0Q29uZmlnO1xufTtcblxuY29uc3QgQ2hhcnRDb250ZXh0ID0gUmVhY3QuY3JlYXRlQ29udGV4dDxDaGFydENvbnRleHRQcm9wcyB8IG51bGw+KG51bGwpO1xuXG5mdW5jdGlvbiB1c2VDaGFydCgpIHtcbiAgY29uc3QgY29udGV4dCA9IFJlYWN0LnVzZUNvbnRleHQoQ2hhcnRDb250ZXh0KTtcblxuICBpZiAoIWNvbnRleHQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1c2VDaGFydCBtdXN0IGJlIHVzZWQgd2l0aGluIGEgPENoYXJ0Q29udGFpbmVyIC8+XCIpO1xuICB9XG5cbiAgcmV0dXJuIGNvbnRleHQ7XG59XG5cbmNvbnN0IENoYXJ0Q29udGFpbmVyID0gUmVhY3QuZm9yd2FyZFJlZjxcbiAgSFRNTERpdkVsZW1lbnQsXG4gIFJlYWN0LkNvbXBvbmVudFByb3BzPFwiZGl2XCI+ICYge1xuICAgIGNvbmZpZzogQ2hhcnRDb25maWc7XG4gICAgY2hpbGRyZW46IFJlYWN0LkNvbXBvbmVudFByb3BzPFxuICAgICAgdHlwZW9mIFJlY2hhcnRzUHJpbWl0aXZlLlJlc3BvbnNpdmVDb250YWluZXJcbiAgICA+W1wiY2hpbGRyZW5cIl07XG4gIH1cbj4oKHsgaWQsIGNsYXNzTmFtZSwgY2hpbGRyZW4sIGNvbmZpZywgLi4ucHJvcHMgfSwgcmVmKSA9PiB7XG4gIGNvbnN0IHVuaXF1ZUlkID0gUmVhY3QudXNlSWQoKTtcbiAgY29uc3QgY2hhcnRJZCA9IGBjaGFydC0ke2lkIHx8IHVuaXF1ZUlkLnJlcGxhY2UoLzovZywgXCJcIil9YDtcblxuICByZXR1cm4gKFxuICAgIDxDaGFydENvbnRleHQuUHJvdmlkZXIgdmFsdWU9e3sgY29uZmlnIH19PlxuICAgICAgPGRpdlxuICAgICAgICBkYXRhLXNsb3Q9XCJjaGFydFwiXG4gICAgICAgIGRhdGEtY2hhcnQ9e2NoYXJ0SWR9XG4gICAgICAgIHJlZj17cmVmfVxuICAgICAgICBjbGFzc05hbWU9e2NuKFxuICAgICAgICAgIFwiWyZfLnJlY2hhcnRzLWNhcnRlc2lhbi1heGlzLXRpY2tfdGV4dF06ZmlsbC1tdXRlZC1mb3JlZ3JvdW5kIFsmXy5yZWNoYXJ0cy1jYXJ0ZXNpYW4tZ3JpZF9saW5lW3N0cm9rZT0nI2NjYyddXTpzdHJva2UtYm9yZGVyLzUwIFsmXy5yZWNoYXJ0cy1jdXJ2ZS5yZWNoYXJ0cy10b29sdGlwLWN1cnNvcl06c3Ryb2tlLWJvcmRlciBbJl8ucmVjaGFydHMtcG9sYXItZ3JpZF9bc3Ryb2tlPScjY2NjJ11dOnN0cm9rZS1ib3JkZXIgWyZfLnJlY2hhcnRzLXJhZGlhbC1iYXItYmFja2dyb3VuZC1zZWN0b3JdOmZpbGwtbXV0ZWQgWyZfLnJlY2hhcnRzLXJlY3RhbmdsZS5yZWNoYXJ0cy10b29sdGlwLWN1cnNvcl06ZmlsbC1tdXRlZCBbJl8ucmVjaGFydHMtcmVmZXJlbmNlLWxpbmVfW3N0cm9rZT0nI2NjYyddXTpzdHJva2UtYm9yZGVyIGZsZXggYXNwZWN0LXZpZGVvIGp1c3RpZnktY2VudGVyIHRleHQteHMgWyZfLnJlY2hhcnRzLWRvdFtzdHJva2U9JyNmZmYnXV06c3Ryb2tlLXRyYW5zcGFyZW50IFsmXy5yZWNoYXJ0cy1sYXllcl06b3V0bGluZS1oaWRkZW4gWyZfLnJlY2hhcnRzLXNlY3Rvcl06b3V0bGluZS1oaWRkZW4gWyZfLnJlY2hhcnRzLXNlY3RvcltzdHJva2U9JyNmZmYnXV06c3Ryb2tlLXRyYW5zcGFyZW50IFsmXy5yZWNoYXJ0cy1zdXJmYWNlXTpvdXRsaW5lLWhpZGRlblwiLFxuICAgICAgICAgIGNsYXNzTmFtZSxcbiAgICAgICAgKX1cbiAgICAgICAgey4uLnByb3BzfVxuICAgICAgPlxuICAgICAgICA8Q2hhcnRTdHlsZSBpZD17Y2hhcnRJZH0gY29uZmlnPXtjb25maWd9IC8+XG4gICAgICAgIDxSZWNoYXJ0c1ByaW1pdGl2ZS5SZXNwb25zaXZlQ29udGFpbmVyPlxuICAgICAgICAgIHtjaGlsZHJlbn1cbiAgICAgICAgPC9SZWNoYXJ0c1ByaW1pdGl2ZS5SZXNwb25zaXZlQ29udGFpbmVyPlxuICAgICAgPC9kaXY+XG4gICAgPC9DaGFydENvbnRleHQuUHJvdmlkZXI+XG4gICk7XG59KTtcbkNoYXJ0Q29udGFpbmVyLmRpc3BsYXlOYW1lID0gXCJDaGFydFwiO1xuXG5jb25zdCBDaGFydFN0eWxlID0gKHsgaWQsIGNvbmZpZyB9OiB7IGlkOiBzdHJpbmc7IGNvbmZpZzogQ2hhcnRDb25maWcgfSkgPT4ge1xuICBjb25zdCBjb2xvckNvbmZpZyA9IE9iamVjdC5lbnRyaWVzKGNvbmZpZykuZmlsdGVyKFxuICAgIChbLCBjb25maWddKSA9PiBjb25maWcudGhlbWUgfHwgY29uZmlnLmNvbG9yLFxuICApO1xuXG4gIGlmICghY29sb3JDb25maWcubGVuZ3RoKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICByZXR1cm4gKFxuICAgIDxzdHlsZVxuICAgICAgZGFuZ2Vyb3VzbHlTZXRJbm5lckhUTUw9e3tcbiAgICAgICAgX19odG1sOiBPYmplY3QuZW50cmllcyhUSEVNRVMpXG4gICAgICAgICAgLm1hcChcbiAgICAgICAgICAgIChbdGhlbWUsIHByZWZpeF0pID0+IGBcbiR7cHJlZml4fSBbZGF0YS1jaGFydD0ke2lkfV0ge1xuJHtjb2xvckNvbmZpZ1xuICAubWFwKChba2V5LCBpdGVtQ29uZmlnXSkgPT4ge1xuICAgIGNvbnN0IGNvbG9yID1cbiAgICAgIGl0ZW1Db25maWcudGhlbWU/Llt0aGVtZSBhcyBrZXlvZiB0eXBlb2YgaXRlbUNvbmZpZy50aGVtZV0gfHxcbiAgICAgIGl0ZW1Db25maWcuY29sb3I7XG4gICAgcmV0dXJuIGNvbG9yID8gYCAgLS1jb2xvci0ke2tleX06ICR7Y29sb3J9O2AgOiBudWxsO1xuICB9KVxuICAuam9pbihcIlxcblwiKX1cbn1cbmAsXG4gICAgICAgICAgKVxuICAgICAgICAgIC5qb2luKFwiXFxuXCIpLFxuICAgICAgfX1cbiAgICAvPlxuICApO1xufTtcblxuY29uc3QgQ2hhcnRUb29sdGlwID0gUmVjaGFydHNQcmltaXRpdmUuVG9vbHRpcDtcblxuY29uc3QgQ2hhcnRUb29sdGlwQ29udGVudCA9IFJlYWN0LmZvcndhcmRSZWY8XG4gIEhUTUxEaXZFbGVtZW50LFxuICBSZWFjdC5Db21wb25lbnRQcm9wczx0eXBlb2YgUmVjaGFydHNQcmltaXRpdmUuVG9vbHRpcD4gJlxuICAgIFJlYWN0LkNvbXBvbmVudFByb3BzPFwiZGl2XCI+ICYge1xuICAgICAgaGlkZUxhYmVsPzogYm9vbGVhbjtcbiAgICAgIGhpZGVJbmRpY2F0b3I/OiBib29sZWFuO1xuICAgICAgaW5kaWNhdG9yPzogXCJsaW5lXCIgfCBcImRvdFwiIHwgXCJkYXNoZWRcIjtcbiAgICAgIG5hbWVLZXk/OiBzdHJpbmc7XG4gICAgICBsYWJlbEtleT86IHN0cmluZztcbiAgICB9XG4+KFxuICAoXG4gICAge1xuICAgICAgYWN0aXZlLFxuICAgICAgcGF5bG9hZCxcbiAgICAgIGNsYXNzTmFtZSxcbiAgICAgIGluZGljYXRvciA9IFwiZG90XCIsXG4gICAgICBoaWRlTGFiZWwgPSBmYWxzZSxcbiAgICAgIGhpZGVJbmRpY2F0b3IgPSBmYWxzZSxcbiAgICAgIGxhYmVsLFxuICAgICAgbGFiZWxGb3JtYXR0ZXIsXG4gICAgICBsYWJlbENsYXNzTmFtZSxcbiAgICAgIGZvcm1hdHRlcixcbiAgICAgIGNvbG9yLFxuICAgICAgbmFtZUtleSxcbiAgICAgIGxhYmVsS2V5LFxuICAgIH0sXG4gICAgcmVmLFxuICApID0+IHtcbiAgICBjb25zdCB7IGNvbmZpZyB9ID0gdXNlQ2hhcnQoKTtcblxuICAgIGNvbnN0IHRvb2x0aXBMYWJlbCA9IFJlYWN0LnVzZU1lbW8oKCkgPT4ge1xuICAgICAgaWYgKGhpZGVMYWJlbCB8fCAhcGF5bG9hZD8ubGVuZ3RoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgICAgfVxuXG4gICAgICBjb25zdCBbaXRlbV0gPSBwYXlsb2FkO1xuICAgICAgY29uc3Qga2V5ID0gYCR7bGFiZWxLZXkgfHwgaXRlbS5kYXRhS2V5IHx8IGl0ZW0ubmFtZSB8fCBcInZhbHVlXCJ9YDtcbiAgICAgIGNvbnN0IGl0ZW1Db25maWcgPSBnZXRQYXlsb2FkQ29uZmlnRnJvbVBheWxvYWQoY29uZmlnLCBpdGVtLCBrZXkpO1xuICAgICAgY29uc3QgdmFsdWUgPVxuICAgICAgICAhbGFiZWxLZXkgJiYgdHlwZW9mIGxhYmVsID09PSBcInN0cmluZ1wiXG4gICAgICAgICAgPyBjb25maWdbbGFiZWwgYXMga2V5b2YgdHlwZW9mIGNvbmZpZ10/LmxhYmVsIHx8IGxhYmVsXG4gICAgICAgICAgOiBpdGVtQ29uZmlnPy5sYWJlbDtcblxuICAgICAgaWYgKGxhYmVsRm9ybWF0dGVyKSB7XG4gICAgICAgIHJldHVybiAoXG4gICAgICAgICAgPGRpdiBjbGFzc05hbWU9e2NuKFwiZm9udC1tZWRpdW1cIiwgbGFiZWxDbGFzc05hbWUpfT5cbiAgICAgICAgICAgIHtsYWJlbEZvcm1hdHRlcih2YWx1ZSwgcGF5bG9hZCl9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICk7XG4gICAgICB9XG5cbiAgICAgIGlmICghdmFsdWUpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT17Y24oXCJmb250LW1lZGl1bVwiLCBsYWJlbENsYXNzTmFtZSl9Pnt2YWx1ZX08L2Rpdj47XG4gICAgfSwgW1xuICAgICAgbGFiZWwsXG4gICAgICBsYWJlbEZvcm1hdHRlcixcbiAgICAgIHBheWxvYWQsXG4gICAgICBoaWRlTGFiZWwsXG4gICAgICBsYWJlbENsYXNzTmFtZSxcbiAgICAgIGNvbmZpZyxcbiAgICAgIGxhYmVsS2V5LFxuICAgIF0pO1xuXG4gICAgaWYgKCFhY3RpdmUgfHwgIXBheWxvYWQ/Lmxlbmd0aCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgY29uc3QgbmVzdExhYmVsID0gcGF5bG9hZC5sZW5ndGggPT09IDEgJiYgaW5kaWNhdG9yICE9PSBcImRvdFwiO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxkaXZcbiAgICAgICAgcmVmPXtyZWZ9XG4gICAgICAgIGNsYXNzTmFtZT17Y24oXG4gICAgICAgICAgXCJib3JkZXItYm9yZGVyLzUwIGJnLWJhY2tncm91bmQgZ3JpZCBtaW4tdy1bOHJlbV0gaXRlbXMtc3RhcnQgZ2FwLTEuNSByb3VuZGVkLWxnIGJvcmRlciBweC0yLjUgcHktMS41IHRleHQteHMgc2hhZG93LXhsXCIsXG4gICAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICApfVxuICAgICAgPlxuICAgICAgICB7IW5lc3RMYWJlbCA/IHRvb2x0aXBMYWJlbCA6IG51bGx9XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwiZ3JpZCBnYXAtMS41XCI+XG4gICAgICAgICAge3BheWxvYWQubWFwKChpdGVtLCBpbmRleCkgPT4ge1xuICAgICAgICAgICAgY29uc3Qga2V5ID0gYCR7bmFtZUtleSB8fCBpdGVtLm5hbWUgfHwgaXRlbS5kYXRhS2V5IHx8IFwidmFsdWVcIn1gO1xuICAgICAgICAgICAgY29uc3QgaXRlbUNvbmZpZyA9IGdldFBheWxvYWRDb25maWdGcm9tUGF5bG9hZChjb25maWcsIGl0ZW0sIGtleSk7XG4gICAgICAgICAgICBjb25zdCBpbmRpY2F0b3JDb2xvciA9IGNvbG9yIHx8IGl0ZW0ucGF5bG9hZC5maWxsIHx8IGl0ZW0uY29sb3I7XG5cbiAgICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICBrZXk9e2l0ZW0uZGF0YUtleX1cbiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NuKFxuICAgICAgICAgICAgICAgICAgXCJbJj5zdmddOnRleHQtbXV0ZWQtZm9yZWdyb3VuZCBmbGV4IHctZnVsbCBmbGV4LXdyYXAgaXRlbXMtc3RyZXRjaCBnYXAtMiBbJj5zdmddOmgtMi41IFsmPnN2Z106dy0yLjVcIixcbiAgICAgICAgICAgICAgICAgIGluZGljYXRvciA9PT0gXCJkb3RcIiAmJiBcIml0ZW1zLWNlbnRlclwiLFxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7Zm9ybWF0dGVyICYmIGl0ZW0/LnZhbHVlICE9PSB1bmRlZmluZWQgJiYgaXRlbS5uYW1lID8gKFxuICAgICAgICAgICAgICAgICAgZm9ybWF0dGVyKGl0ZW0udmFsdWUsIGl0ZW0ubmFtZSwgaXRlbSwgaW5kZXgsIGl0ZW0ucGF5bG9hZClcbiAgICAgICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICAgICAgPD5cbiAgICAgICAgICAgICAgICAgICAge2l0ZW1Db25maWc/Lmljb24gPyAoXG4gICAgICAgICAgICAgICAgICAgICAgPGl0ZW1Db25maWcuaWNvbiAvPlxuICAgICAgICAgICAgICAgICAgICApIDogKFxuICAgICAgICAgICAgICAgICAgICAgICFoaWRlSW5kaWNhdG9yICYmIChcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXZcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInNocmluay0wIHJvdW5kZWQtWzJweF0gYm9yZGVyLSgtLWNvbG9yLWJvcmRlcikgYmctKC0tY29sb3ItYmcpXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJoLTIuNSB3LTIuNVwiOiBpbmRpY2F0b3IgPT09IFwiZG90XCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcInctMVwiOiBpbmRpY2F0b3IgPT09IFwibGluZVwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCJ3LTAgYm9yZGVyLVsxLjVweF0gYm9yZGVyLWRhc2hlZCBiZy10cmFuc3BhcmVudFwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRpY2F0b3IgPT09IFwiZGFzaGVkXCIsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIm15LTAuNVwiOiBuZXN0TGFiZWwgJiYgaW5kaWNhdG9yID09PSBcImRhc2hlZFwiLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIHN0eWxlPXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi0tY29sb3ItYmdcIjogaW5kaWNhdG9yQ29sb3IsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcIi0tY29sb3ItYm9yZGVyXCI6IGluZGljYXRvckNvbG9yLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gYXMgUmVhY3QuQ1NTUHJvcGVydGllc1xuICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT17Y24oXG4gICAgICAgICAgICAgICAgICAgICAgICBcImZsZXggZmxleC0xIGp1c3RpZnktYmV0d2VlbiBsZWFkaW5nLW5vbmVcIixcbiAgICAgICAgICAgICAgICAgICAgICAgIG5lc3RMYWJlbCA/IFwiaXRlbXMtZW5kXCIgOiBcIml0ZW1zLWNlbnRlclwiLFxuICAgICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImdyaWQgZ2FwLTEuNVwiPlxuICAgICAgICAgICAgICAgICAgICAgICAge25lc3RMYWJlbCA/IHRvb2x0aXBMYWJlbCA6IG51bGx9XG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJ0ZXh0LW11dGVkLWZvcmVncm91bmRcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAge2l0ZW1Db25maWc/LmxhYmVsIHx8IGl0ZW0ubmFtZX1cbiAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgICAgICAgICB7aXRlbS52YWx1ZSAmJiAoXG4gICAgICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9XCJ0ZXh0LWZvcmVncm91bmQgZm9udC1tb25vIGZvbnQtbWVkaXVtIHRhYnVsYXItbnVtc1wiPlxuICAgICAgICAgICAgICAgICAgICAgICAgICB7aXRlbS52YWx1ZS50b0xvY2FsZVN0cmluZygpfVxuICAgICAgICAgICAgICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgICAgIDwvZGl2PlxuICAgICAgICAgICAgICAgICAgPC8+XG4gICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pfVxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH0sXG4pO1xuQ2hhcnRUb29sdGlwQ29udGVudC5kaXNwbGF5TmFtZSA9IFwiQ2hhcnRUb29sdGlwXCI7XG5cbmNvbnN0IENoYXJ0TGVnZW5kID0gUmVjaGFydHNQcmltaXRpdmUuTGVnZW5kO1xuXG5jb25zdCBDaGFydExlZ2VuZENvbnRlbnQgPSBSZWFjdC5mb3J3YXJkUmVmPFxuICBIVE1MRGl2RWxlbWVudCxcbiAgUmVhY3QuQ29tcG9uZW50UHJvcHM8XCJkaXZcIj4gJlxuICAgIFBpY2s8UmVjaGFydHNQcmltaXRpdmUuTGVnZW5kUHJvcHMsIFwicGF5bG9hZFwiIHwgXCJ2ZXJ0aWNhbEFsaWduXCI+ICYge1xuICAgICAgaGlkZUljb24/OiBib29sZWFuO1xuICAgICAgbmFtZUtleT86IHN0cmluZztcbiAgICB9XG4+KFxuICAoXG4gICAgeyBjbGFzc05hbWUsIGhpZGVJY29uID0gZmFsc2UsIHBheWxvYWQsIHZlcnRpY2FsQWxpZ24gPSBcImJvdHRvbVwiLCBuYW1lS2V5IH0sXG4gICAgcmVmLFxuICApID0+IHtcbiAgICBjb25zdCB7IGNvbmZpZyB9ID0gdXNlQ2hhcnQoKTtcblxuICAgIGlmICghcGF5bG9hZD8ubGVuZ3RoKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gKFxuICAgICAgPGRpdlxuICAgICAgICByZWY9e3JlZn1cbiAgICAgICAgY2xhc3NOYW1lPXtjbihcbiAgICAgICAgICBcImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC00XCIsXG4gICAgICAgICAgdmVydGljYWxBbGlnbiA9PT0gXCJ0b3BcIiA/IFwicGItM1wiIDogXCJwdC0zXCIsXG4gICAgICAgICAgY2xhc3NOYW1lLFxuICAgICAgICApfVxuICAgICAgPlxuICAgICAgICB7cGF5bG9hZC5tYXAoKGl0ZW0pID0+IHtcbiAgICAgICAgICBjb25zdCBrZXkgPSBgJHtuYW1lS2V5IHx8IGl0ZW0uZGF0YUtleSB8fCBcInZhbHVlXCJ9YDtcbiAgICAgICAgICBjb25zdCBpdGVtQ29uZmlnID0gZ2V0UGF5bG9hZENvbmZpZ0Zyb21QYXlsb2FkKGNvbmZpZywgaXRlbSwga2V5KTtcblxuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgIGtleT17aXRlbS52YWx1ZX1cbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtjbihcbiAgICAgICAgICAgICAgICBcIlsmPnN2Z106dGV4dC1tdXRlZC1mb3JlZ3JvdW5kIGZsZXggaXRlbXMtY2VudGVyIGdhcC0xLjUgWyY+c3ZnXTpoLTMgWyY+c3ZnXTp3LTNcIixcbiAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge2l0ZW1Db25maWc/Lmljb24gJiYgIWhpZGVJY29uID8gKFxuICAgICAgICAgICAgICAgIDxpdGVtQ29uZmlnLmljb24gLz5cbiAgICAgICAgICAgICAgKSA6IChcbiAgICAgICAgICAgICAgICA8ZGl2XG4gICAgICAgICAgICAgICAgICBjbGFzc05hbWU9XCJoLTIgdy0yIHNocmluay0wIHJvdW5kZWQtWzJweF1cIlxuICAgICAgICAgICAgICAgICAgc3R5bGU9e3tcbiAgICAgICAgICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBpdGVtLmNvbG9yLFxuICAgICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICB7aXRlbUNvbmZpZz8ubGFiZWx9XG4gICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICApO1xuICAgICAgICB9KX1cbiAgICAgIDwvZGl2PlxuICAgICk7XG4gIH0sXG4pO1xuQ2hhcnRMZWdlbmRDb250ZW50LmRpc3BsYXlOYW1lID0gXCJDaGFydExlZ2VuZFwiO1xuXG4vLyBIZWxwZXIgdG8gZXh0cmFjdCBpdGVtIGNvbmZpZyBmcm9tIGEgcGF5bG9hZC5cbmZ1bmN0aW9uIGdldFBheWxvYWRDb25maWdGcm9tUGF5bG9hZChcbiAgY29uZmlnOiBDaGFydENvbmZpZyxcbiAgcGF5bG9hZDogdW5rbm93bixcbiAga2V5OiBzdHJpbmcsXG4pIHtcbiAgaWYgKHR5cGVvZiBwYXlsb2FkICE9PSBcIm9iamVjdFwiIHx8IHBheWxvYWQgPT09IG51bGwpIHtcbiAgICByZXR1cm4gdW5kZWZpbmVkO1xuICB9XG5cbiAgY29uc3QgcGF5bG9hZFBheWxvYWQgPVxuICAgIFwicGF5bG9hZFwiIGluIHBheWxvYWQgJiZcbiAgICB0eXBlb2YgcGF5bG9hZC5wYXlsb2FkID09PSBcIm9iamVjdFwiICYmXG4gICAgcGF5bG9hZC5wYXlsb2FkICE9PSBudWxsXG4gICAgICA/IHBheWxvYWQucGF5bG9hZFxuICAgICAgOiB1bmRlZmluZWQ7XG5cbiAgbGV0IGNvbmZpZ0xhYmVsS2V5OiBzdHJpbmcgPSBrZXk7XG5cbiAgaWYgKFxuICAgIGtleSBpbiBwYXlsb2FkICYmXG4gICAgdHlwZW9mIHBheWxvYWRba2V5IGFzIGtleW9mIHR5cGVvZiBwYXlsb2FkXSA9PT0gXCJzdHJpbmdcIlxuICApIHtcbiAgICBjb25maWdMYWJlbEtleSA9IHBheWxvYWRba2V5IGFzIGtleW9mIHR5cGVvZiBwYXlsb2FkXSBhcyBzdHJpbmc7XG4gIH0gZWxzZSBpZiAoXG4gICAgcGF5bG9hZFBheWxvYWQgJiZcbiAgICBrZXkgaW4gcGF5bG9hZFBheWxvYWQgJiZcbiAgICB0eXBlb2YgcGF5bG9hZFBheWxvYWRba2V5IGFzIGtleW9mIHR5cGVvZiBwYXlsb2FkUGF5bG9hZF0gPT09IFwic3RyaW5nXCJcbiAgKSB7XG4gICAgY29uZmlnTGFiZWxLZXkgPSBwYXlsb2FkUGF5bG9hZFtcbiAgICAgIGtleSBhcyBrZXlvZiB0eXBlb2YgcGF5bG9hZFBheWxvYWRcbiAgICBdIGFzIHN0cmluZztcbiAgfVxuXG4gIHJldHVybiBjb25maWdMYWJlbEtleSBpbiBjb25maWdcbiAgICA/IGNvbmZpZ1tjb25maWdMYWJlbEtleV1cbiAgICA6IGNvbmZpZ1trZXkgYXMga2V5b2YgdHlwZW9mIGNvbmZpZ107XG59XG5cbmV4cG9ydCB7XG4gIENoYXJ0Q29udGFpbmVyLFxuICBDaGFydFRvb2x0aXAsXG4gIENoYXJ0VG9vbHRpcENvbnRlbnQsXG4gIENoYXJ0TGVnZW5kLFxuICBDaGFydExlZ2VuZENvbnRlbnQsXG4gIENoYXJ0U3R5bGUsXG59O1xuIl19